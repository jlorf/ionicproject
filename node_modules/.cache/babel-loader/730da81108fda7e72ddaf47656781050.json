{"ast":null,"code":"var _jsxFileName = \"/home/joel/projecteionic/src/data/ContextProvider.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport * as $ from 'jquery';\nimport ActivitiesContext from './context';\n\nconst ContextProvider = props => {\n  _s();\n\n  var _globalThis$localStor;\n\n  const [activities, setActivities] = useState([{\n    id: Math.random().toString(),\n    title: 'My daily sleep',\n    description: 'Sleep through the night after a day of quarantine',\n    hour: '23:00',\n    activityType: 'rest',\n    imageUrl: '/assets/images/rest.jpg',\n    isCompleted: false\n  }, {\n    id: Math.random().toString(),\n    title: 'Hard work',\n    description: 'Work in the projects I have at Tribalyte',\n    hour: '9:00',\n    activityType: 'work',\n    imageUrl: '/assets/images/work.jpg',\n    isCompleted: false\n  }, {\n    id: Math.random().toString(),\n    title: 'Play ping pong',\n    description: 'Play a ping pong match on the hall table!',\n    hour: '19:00',\n    activityType: 'hobby',\n    imageUrl: '/assets/images/hobby.jpg',\n    isCompleted: false\n  }]);\n\n  const ObtenirPersones = (ctx, professor) => {\n    var persones = Array();\n    $.ajax({\n      method: \"GET\",\n      url: \"http://192.168.2.212/ProjecteGit/Api/persona/json.php?professor=\" + (professor ? 1 : 0),\n      data: {\n        jwt: ctx.jwt\n      }\n    }).done(function (res) {\n      //console.log(jwt);\n      $.each(res.records, function (i, item) {\n        persones.push({\n          codi: item.codi,\n          Nom: item.Nom,\n          Cognoms: item.Cognoms,\n          professor: item.professor\n        });\n      });\n\n      if (professor) {\n        ctx.professors = persones;\n      } else {\n        ctx.alumnes = persones;\n      }\n    });\n  };\n\n  const ObtenirModuls = ctx => {\n    var moduls = Array();\n    $.ajax({\n      method: \"GET\",\n      url: \"http://192.168.2.212/ProjecteGit/Api/modul/api.php\",\n      data: {\n        jwt: ctx.jwt\n      }\n    }).done(function (res) {\n      //console.log(jwt);\n      $.each(res.records, function (i, item) {\n        moduls.push({\n          codi: item.codi,\n          Nom: item.Nom,\n          Abrev: item.Abrev\n        });\n      });\n      ctx.moduls = moduls;\n    });\n  };\n\n  const Login = (ctx, email, password) => {\n    $.ajax({\n      method: \"POST\",\n      url: \"http://192.168.2.212/ProjecteGit/JWT/login.php\",\n      data: {\n        email: email,\n        password: password\n      },\n      error: function (request, status, error) {\n        setLogged(false);\n        presentAlert('Login', 'Error', request.responseText, ['Ok']);\n      }\n    }).done(function (res) {\n      if (res.jwt) {\n        presentAlert('Login', 'Correcte', res.message, ['Ok']); //activitiesContext.jwt = res.jwt;\n\n        ctx.logged = true;\n        ctx.jwt = res.jwt;\n        globalThis.localStorage.setItem('JWT', res.jwt);\n        window.location.replace('moduls');\n      }\n    });\n  };\n\n  const presentAlert = async function (titol, subtitol, text, buttons) {\n    const alert = document.createElement('ion-alert');\n    alert.cssClass = 'my-custom-class';\n    alert.header = titol;\n    alert.subHeader = subtitol;\n    alert.message = text;\n    alert.buttons = buttons;\n    document.body.appendChild(alert);\n    await alert.present();\n    const {\n      role\n    } = await alert.onDidDismiss();\n    console.log('onDidDismiss resolved with role', role);\n  };\n\n  const Registrar = (ctx, nom, cognom, email, password) => {\n    $.ajax({\n      method: \"POST\",\n      url: \"http://192.168.2.212/ProjecteGit/JWT/create_user.php\",\n      data: {\n        firstname: nom,\n        lastname: cognom,\n        email: email,\n        password: password\n      },\n      error: function (request, status, error) {\n        presentAlert('Registre', 'Error', request.responseText, ['Ok']);\n      }\n    }).done(function (res) {\n      ctx.presentAlert(\"Registre\", \"\", res.message, [\"OK\"]);\n      window.location.replace('login');\n    });\n  };\n\n  const [professors, setProfessors] = useState([]);\n  const [alumnes, setAlumnes] = useState([]);\n  const [moduls, setModuls] = useState([]);\n\n  const addActivity = (title, description, activityType) => {\n    let imageUrl = '';\n\n    switch (activityType) {\n      case 'rest':\n        imageUrl = '/assets/images/rest.jpg';\n        break;\n\n      case 'hobby':\n        imageUrl = '/assets/images/hobby.jpg';\n        break;\n\n      case 'work':\n        imageUrl = '/assets/images/work.jpg';\n        break;\n\n      default:\n        imageUrl = '/assets/images/work.jpg';\n        break;\n    }\n\n    ;\n    const activityDate = new Date();\n    const hour = activityDate.getHours() + ':' + activityDate.getMinutes();\n    const addActivity = {\n      id: Math.random().toString(),\n      title,\n      description,\n      hour,\n      activityType,\n      imageUrl,\n      isCompleted: false\n    };\n    setActivities(currActivities => {\n      return [...currActivities, addActivity];\n    });\n  };\n\n  const completeActivity = activityId => {\n    setActivities(currActivities => {\n      const updatedActivities = [...currActivities];\n      const selectedActivityIndex = activities.findIndex(act => act.id === activityId);\n      const updatedActivity = { ...updatedActivities[selectedActivityIndex],\n        isCompleted: true\n      };\n      updatedActivities[selectedActivityIndex] = updatedActivity;\n      return updatedActivities;\n    });\n  };\n\n  const ComprovarJWT = () => {\n    var item = globalThis.localStorage.getItem(\"JWT\");\n    setJWT(item !== null && item !== void 0 ? item : '');\n    var res = $.ajax({\n      method: \"POST\",\n      url: \"http://192.168.2.212/ProjecteGit/JWT/validate_token.php\",\n      data: {\n        jwt: jwt\n      },\n      async: false\n    }).responseText;\n    debugger;\n\n    if (res != null && res != undefined) {\n      var resJSON = JSON.parse(res); // .done(function(res: Validar) {\n\n      if ((resJSON === null || resJSON === void 0 ? void 0 : resJSON.message) == \"Access granted.\" && (resJSON === null || resJSON === void 0 ? void 0 : resJSON.data) != null) {\n        //activitiesContext.jwt = res.jwt;\n        setLogged(true);\n        setJWT(item !== null && item !== void 0 ? item : '');\n      } else {\n        setLogged(false);\n      }\n    } else {\n      setLogged(false);\n    }\n\n    return logged;\n  };\n\n  const [jwt, setJWT] = useState('');\n  const [logged, setLogged] = useState(false);\n  const activitiesContext = {\n    activities,\n    addActivity,\n    completeActivity,\n    alumnes,\n    professors,\n    ObtenirPersones,\n    jwt: (_globalThis$localStor = globalThis.localStorage.getItem(\"JWT\")) !== null && _globalThis$localStor !== void 0 ? _globalThis$localStor : '',\n    urlapi: '192.168.2.212',\n    logged: false,\n    Login,\n    Registrar,\n    presentAlert,\n    moduls,\n    ObtenirModuls,\n    ComprovarJWT\n  };\n  return /*#__PURE__*/React.createElement(ActivitiesContext.Provider, {\n    value: activitiesContext,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 9\n    }\n  }, props.children);\n};\n\n_s(ContextProvider, \"+Iudja2+bKLkvbutp72G9MGx2hQ=\");\n\n_c = ContextProvider;\nexport default ContextProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"ContextProvider\");","map":{"version":3,"sources":["/home/joel/projecteionic/src/data/ContextProvider.tsx"],"names":["React","useState","$","ActivitiesContext","ContextProvider","props","activities","setActivities","id","Math","random","toString","title","description","hour","activityType","imageUrl","isCompleted","ObtenirPersones","ctx","professor","persones","Array","ajax","method","url","data","jwt","done","res","each","records","i","item","push","codi","Nom","Cognoms","professors","alumnes","ObtenirModuls","moduls","Abrev","Login","email","password","error","request","status","setLogged","presentAlert","responseText","message","logged","globalThis","localStorage","setItem","window","location","replace","titol","subtitol","text","buttons","alert","document","createElement","cssClass","header","subHeader","body","appendChild","present","role","onDidDismiss","console","log","Registrar","nom","cognom","firstname","lastname","setProfessors","setAlumnes","setModuls","addActivity","activityDate","Date","getHours","getMinutes","currActivities","completeActivity","activityId","updatedActivities","selectedActivityIndex","findIndex","act","updatedActivity","ComprovarJWT","getItem","setJWT","async","undefined","resJSON","JSON","parse","activitiesContext","urlapi","children"],"mappings":"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","sourcesContent":["import React, { useState, useContext } from 'react';\nimport * as $ from 'jquery'\nimport ActivitiesContext, { Activity, ContextModel, ActivityType, Persona, LoginReturn, Modul, Validar } from './context';\n\nconst ContextProvider: React.FC = (props) => {\n\n    const [activities, setActivities] = useState<Activity[]>([\n        {\n            id: Math.random().toString(),\n            title: 'My daily sleep',\n            description: 'Sleep through the night after a day of quarantine',\n            hour: '23:00',\n            activityType: 'rest',\n            imageUrl: '/assets/images/rest.jpg',\n            isCompleted: false\n        },\n        {\n            id: Math.random().toString(),\n            title: 'Hard work',\n            description: 'Work in the projects I have at Tribalyte',\n            hour: '9:00',\n            activityType: 'work',\n            imageUrl: '/assets/images/work.jpg',\n            isCompleted: false\n        },\n        {\n            id: Math.random().toString(),\n            title: 'Play ping pong',\n            description: 'Play a ping pong match on the hall table!',\n            hour: '19:00',\n            activityType: 'hobby',\n            imageUrl: '/assets/images/hobby.jpg',\n            isCompleted: false\n        }\n    ]);\n\n    const ObtenirPersones = (ctx: ContextModel, professor: boolean) => {\n        var persones = Array<Persona>();\n        $.ajax({\n            method: \"GET\",\n            url: \"http://192.168.2.212/ProjecteGit/Api/persona/json.php?professor=\" + (professor ? 1 : 0),\n            data: {jwt: ctx.jwt}\n        })\n            .done(function(res) {\n                //console.log(jwt);\n                $.each(res.records, function(i, item : Persona) {\n                    persones.push({\n                        codi: item.codi,\n                        Nom: item.Nom,\n                        Cognoms: item.Cognoms,\n                        professor: item.professor\n                    })\n                  });\n                  if (professor)\n                  {\n                    ctx.professors = persones;\n                  } else {\n                    ctx.alumnes = persones;\n                  }\n            });\n    };\n\n    const ObtenirModuls = (ctx: ContextModel) => {\n        var moduls = Array<Modul>();\n        $.ajax({\n            method: \"GET\",\n            url: \"http://192.168.2.212/ProjecteGit/Api/modul/api.php\",\n            data: {jwt: ctx.jwt}\n        })\n            .done(function(res) {\n                //console.log(jwt);\n                $.each(res.records, function(i, item : Modul) {\n                    moduls.push({\n                        codi: item.codi,\n                        Nom: item.Nom,\n                        Abrev: item.Abrev\n                    })\n                  });\n                ctx.moduls = moduls;\n            });\n    };\n\n    const Login = (ctx: ContextModel, email: string, password: string) => {\n        $.ajax({\n            method: \"POST\",\n            url: \"http://192.168.2.212/ProjecteGit/JWT/login.php\",\n            data: { email: email, password: password },\n            error: function (request, status, error) {\n                setLogged(false);\n                presentAlert('Login', 'Error', request.responseText, ['Ok']);\n            }\n        })\n            .done(function(res: LoginReturn) {\n                if (res.jwt){\n                    presentAlert('Login', 'Correcte', res.message, ['Ok']);\n                    //activitiesContext.jwt = res.jwt;\n                    ctx.logged = true;\n                    ctx.jwt = res.jwt;\n                    globalThis.localStorage.setItem('JWT', res.jwt);\n                    window.location.replace('moduls');\n                }\n            });\n    };\n\n    const presentAlert = async function(titol: string, subtitol: string, text: string, buttons: string[]) {\n        const alert = document.createElement('ion-alert');\n        alert.cssClass = 'my-custom-class';\n        alert.header = titol;\n        alert.subHeader = subtitol;\n        alert.message = text;\n        alert.buttons = buttons;\n      \n        document.body.appendChild(alert);\n        await alert.present();\n      \n        const { role } = await alert.onDidDismiss();\n        console.log('onDidDismiss resolved with role', role);\n      }\n      \n\n    const Registrar = (ctx: ContextModel, nom: string, cognom: string, email: string, password: string) => {\n        $.ajax({\n            method: \"POST\",\n            url: \"http://192.168.2.212/ProjecteGit/JWT/create_user.php\",\n            data: { firstname: nom, lastname: cognom, email: email, password: password },\n            error: function (request, status, error) {\n                presentAlert('Registre', 'Error', request.responseText, ['Ok']);\n            }\n        })\n            .done(function(res: LoginReturn) {\n                ctx.presentAlert(\"Registre\", \"\", res.message, [\"OK\"]);\n                window.location.replace('login');\n            });\n    };\n\n    const [professors, setProfessors] = useState<Persona[]>([]);\n\n    const [alumnes, setAlumnes] = useState<Persona[]>([]);\n\n    const [moduls, setModuls] = useState<Modul[]>([]);\n\n    const addActivity = (title: string, description: string, activityType: ActivityType) => {\n        let imageUrl = '';\n        switch(activityType) {\n            case 'rest':\n                imageUrl = '/assets/images/rest.jpg'\n                break;\n            case 'hobby':\n                imageUrl = '/assets/images/hobby.jpg'\n                break;\n            case 'work':\n                imageUrl = '/assets/images/work.jpg'\n                break;\n            default:\n                imageUrl = '/assets/images/work.jpg'\n                break;\n        };\n\n        const activityDate = new Date();\n        const hour = activityDate.getHours() + ':' + activityDate.getMinutes();\n\n        const addActivity: Activity = {\n            id: Math.random().toString(),\n            title,\n            description,\n            hour,\n            activityType,\n            imageUrl,\n            isCompleted: false\n        };\n\n        setActivities(currActivities => {\n            return [...currActivities, addActivity]\n        })\n    };\n\n    const completeActivity = (activityId: string) => {\n        setActivities(currActivities => {\n            const updatedActivities = [...currActivities];\n            const selectedActivityIndex = activities.findIndex(act => act.id === activityId);\n            const updatedActivity = {...updatedActivities[selectedActivityIndex], isCompleted: true};\n            updatedActivities[selectedActivityIndex] = updatedActivity;\n            return updatedActivities;\n        });\n    };\n\n\n\n    const ComprovarJWT = () => {\n        var item = globalThis.localStorage.getItem(\"JWT\");\n        setJWT(item ?? '');\n        var res = $.ajax({\n            method: \"POST\",\n            url: \"http://192.168.2.212/ProjecteGit/JWT/validate_token.php\",\n            data: { jwt: jwt },\n            async: false\n        }).responseText;\n        debugger;\n        if (res != null && res != undefined){\n        var resJSON = JSON.parse(res);\n            // .done(function(res: Validar) {\n            if (resJSON?.message == \"Access granted.\" && resJSON?.data != null){\n                //activitiesContext.jwt = res.jwt;\n                setLogged(true);\n                setJWT(item ?? '');\n            } else {\n                setLogged(false);\n            }\n        } else {\n            setLogged(false);\n        }\n        return logged;\n    };\n\n    const [jwt, setJWT] = useState<string>('');\n\n    const [logged, setLogged] = useState<boolean>(false);\n\n    const activitiesContext: ContextModel = {\n        activities,\n        addActivity,\n        completeActivity,\n        alumnes,\n        professors,\n        ObtenirPersones,\n        jwt: globalThis.localStorage.getItem(\"JWT\") ?? '',\n        urlapi: '192.168.2.212',\n        logged: false,\n        Login,\n        Registrar,\n        presentAlert,\n        moduls,\n        ObtenirModuls,\n        ComprovarJWT\n    };\n\n    return (\n        <ActivitiesContext.Provider value={activitiesContext}>\n            {props.children}\n        </ActivitiesContext.Provider>\n    );\n};\n\nexport default ContextProvider;"]},"metadata":{},"sourceType":"module"}