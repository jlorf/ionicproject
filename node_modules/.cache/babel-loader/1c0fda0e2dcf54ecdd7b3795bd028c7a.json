{"ast":null,"code":"/**\n * Does a simple sanitization of all elements\n * in an untrusted string\n */\nconst sanitizeDOMString = untrustedString => {\n  try {\n    if (typeof untrustedString !== 'string' || untrustedString === '') {\n      return untrustedString;\n    }\n    /**\n     * Create a document fragment\n     * separate from the main DOM,\n     * create a div to do our work in\n     */\n\n\n    const documentFragment = document.createDocumentFragment();\n    const workingDiv = document.createElement('div');\n    documentFragment.appendChild(workingDiv);\n    workingDiv.innerHTML = untrustedString;\n    /**\n     * Remove any elements\n     * that are blocked\n     */\n\n    blockedTags.forEach(blockedTag => {\n      const getElementsToRemove = documentFragment.querySelectorAll(blockedTag);\n\n      for (let elementIndex = getElementsToRemove.length - 1; elementIndex >= 0; elementIndex--) {\n        const element = getElementsToRemove[elementIndex];\n\n        if (element.parentNode) {\n          element.parentNode.removeChild(element);\n        } else {\n          documentFragment.removeChild(element);\n        }\n        /**\n         * We still need to sanitize\n         * the children of this element\n         * as they are left behind\n         */\n\n\n        const childElements = getElementChildren(element);\n        /* tslint:disable-next-line */\n\n        for (let childIndex = 0; childIndex < childElements.length; childIndex++) {\n          sanitizeElement(childElements[childIndex]);\n        }\n      }\n    });\n    /**\n     * Go through remaining elements and remove\n     * non-allowed attribs\n     */\n    // IE does not support .children on document fragments, only .childNodes\n\n    const dfChildren = getElementChildren(documentFragment);\n    /* tslint:disable-next-line */\n\n    for (let childIndex = 0; childIndex < dfChildren.length; childIndex++) {\n      sanitizeElement(dfChildren[childIndex]);\n    } // Append document fragment to div\n\n\n    const fragmentDiv = document.createElement('div');\n    fragmentDiv.appendChild(documentFragment); // First child is always the div we did our work in\n\n    const getInnerDiv = fragmentDiv.querySelector('div');\n    return getInnerDiv !== null ? getInnerDiv.innerHTML : fragmentDiv.innerHTML;\n  } catch (err) {\n    console.error(err);\n    return '';\n  }\n};\n/**\n * Clean up current element based on allowed attributes\n * and then recursively dig down into any child elements to\n * clean those up as well\n */\n\n\nconst sanitizeElement = element => {\n  // IE uses childNodes, so ignore nodes that are not elements\n  if (element.nodeType && element.nodeType !== 1) {\n    return;\n  }\n\n  for (let i = element.attributes.length - 1; i >= 0; i--) {\n    const attribute = element.attributes.item(i);\n    const attributeName = attribute.name; // remove non-allowed attribs\n\n    if (!allowedAttributes.includes(attributeName.toLowerCase())) {\n      element.removeAttribute(attributeName);\n      continue;\n    } // clean up any allowed attribs\n    // that attempt to do any JS funny-business\n\n\n    const attributeValue = attribute.value;\n    /* tslint:disable-next-line */\n\n    if (attributeValue != null && attributeValue.toLowerCase().includes('javascript:')) {\n      element.removeAttribute(attributeName);\n    }\n  }\n  /**\n   * Sanitize any nested children\n   */\n\n\n  const childElements = getElementChildren(element);\n  /* tslint:disable-next-line */\n\n  for (let i = 0; i < childElements.length; i++) {\n    sanitizeElement(childElements[i]);\n  }\n};\n/**\n * IE doesn't always support .children\n * so we revert to .childNodes instead\n */\n\n\nconst getElementChildren = el => {\n  return el.children != null ? el.children : el.childNodes;\n};\n\nconst allowedAttributes = ['class', 'id', 'href', 'src', 'name', 'slot'];\nconst blockedTags = ['script', 'style', 'iframe', 'meta', 'link', 'object', 'embed'];\nexport { sanitizeDOMString as s };","map":{"version":3,"sources":["/home/joel/projecteionic/node_modules/@ionic/core/dist/esm-es5/index-729ec402.js"],"names":["sanitizeDOMString","untrustedString","documentFragment","document","createDocumentFragment","workingDiv","createElement","appendChild","innerHTML","blockedTags","forEach","blockedTag","getElementsToRemove","querySelectorAll","elementIndex","length","element","parentNode","removeChild","childElements","getElementChildren","childIndex","sanitizeElement","dfChildren","fragmentDiv","getInnerDiv","querySelector","err","console","error","nodeType","i","attributes","attribute","item","attributeName","name","allowedAttributes","includes","toLowerCase","removeAttribute","attributeValue","value","el","children","childNodes","s"],"mappings":"AAAA;AACA;AACA;AACA;AACA,MAAMA,iBAAiB,GAAIC,eAAD,IAAqB;AAC3C,MAAI;AACA,QAAI,OAAOA,eAAP,KAA2B,QAA3B,IAAuCA,eAAe,KAAK,EAA/D,EAAmE;AAC/D,aAAOA,eAAP;AACH;AACD;AACR;AACA;AACA;AACA;;;AACQ,UAAMC,gBAAgB,GAAGC,QAAQ,CAACC,sBAAT,EAAzB;AACA,UAAMC,UAAU,GAAGF,QAAQ,CAACG,aAAT,CAAuB,KAAvB,CAAnB;AACAJ,IAAAA,gBAAgB,CAACK,WAAjB,CAA6BF,UAA7B;AACAA,IAAAA,UAAU,CAACG,SAAX,GAAuBP,eAAvB;AACA;AACR;AACA;AACA;;AACQQ,IAAAA,WAAW,CAACC,OAAZ,CAAoBC,UAAU,IAAI;AAC9B,YAAMC,mBAAmB,GAAGV,gBAAgB,CAACW,gBAAjB,CAAkCF,UAAlC,CAA5B;;AACA,WAAK,IAAIG,YAAY,GAAGF,mBAAmB,CAACG,MAApB,GAA6B,CAArD,EAAwDD,YAAY,IAAI,CAAxE,EAA2EA,YAAY,EAAvF,EAA2F;AACvF,cAAME,OAAO,GAAGJ,mBAAmB,CAACE,YAAD,CAAnC;;AACA,YAAIE,OAAO,CAACC,UAAZ,EAAwB;AACpBD,UAAAA,OAAO,CAACC,UAAR,CAAmBC,WAAnB,CAA+BF,OAA/B;AACH,SAFD,MAGK;AACDd,UAAAA,gBAAgB,CAACgB,WAAjB,CAA6BF,OAA7B;AACH;AACD;AAChB;AACA;AACA;AACA;;;AACgB,cAAMG,aAAa,GAAGC,kBAAkB,CAACJ,OAAD,CAAxC;AACA;;AACA,aAAK,IAAIK,UAAU,GAAG,CAAtB,EAAyBA,UAAU,GAAGF,aAAa,CAACJ,MAApD,EAA4DM,UAAU,EAAtE,EAA0E;AACtEC,UAAAA,eAAe,CAACH,aAAa,CAACE,UAAD,CAAd,CAAf;AACH;AACJ;AACJ,KArBD;AAsBA;AACR;AACA;AACA;AACQ;;AACA,UAAME,UAAU,GAAGH,kBAAkB,CAAClB,gBAAD,CAArC;AACA;;AACA,SAAK,IAAImB,UAAU,GAAG,CAAtB,EAAyBA,UAAU,GAAGE,UAAU,CAACR,MAAjD,EAAyDM,UAAU,EAAnE,EAAuE;AACnEC,MAAAA,eAAe,CAACC,UAAU,CAACF,UAAD,CAAX,CAAf;AACH,KAhDD,CAiDA;;;AACA,UAAMG,WAAW,GAAGrB,QAAQ,CAACG,aAAT,CAAuB,KAAvB,CAApB;AACAkB,IAAAA,WAAW,CAACjB,WAAZ,CAAwBL,gBAAxB,EAnDA,CAoDA;;AACA,UAAMuB,WAAW,GAAGD,WAAW,CAACE,aAAZ,CAA0B,KAA1B,CAApB;AACA,WAAQD,WAAW,KAAK,IAAjB,GAAyBA,WAAW,CAACjB,SAArC,GAAiDgB,WAAW,CAAChB,SAApE;AACH,GAvDD,CAwDA,OAAOmB,GAAP,EAAY;AACRC,IAAAA,OAAO,CAACC,KAAR,CAAcF,GAAd;AACA,WAAO,EAAP;AACH;AACJ,CA7DD;AA8DA;AACA;AACA;AACA;AACA;;;AACA,MAAML,eAAe,GAAIN,OAAD,IAAa;AACjC;AACA,MAAIA,OAAO,CAACc,QAAR,IAAoBd,OAAO,CAACc,QAAR,KAAqB,CAA7C,EAAgD;AAC5C;AACH;;AACD,OAAK,IAAIC,CAAC,GAAGf,OAAO,CAACgB,UAAR,CAAmBjB,MAAnB,GAA4B,CAAzC,EAA4CgB,CAAC,IAAI,CAAjD,EAAoDA,CAAC,EAArD,EAAyD;AACrD,UAAME,SAAS,GAAGjB,OAAO,CAACgB,UAAR,CAAmBE,IAAnB,CAAwBH,CAAxB,CAAlB;AACA,UAAMI,aAAa,GAAGF,SAAS,CAACG,IAAhC,CAFqD,CAGrD;;AACA,QAAI,CAACC,iBAAiB,CAACC,QAAlB,CAA2BH,aAAa,CAACI,WAAd,EAA3B,CAAL,EAA8D;AAC1DvB,MAAAA,OAAO,CAACwB,eAAR,CAAwBL,aAAxB;AACA;AACH,KAPoD,CAQrD;AACA;;;AACA,UAAMM,cAAc,GAAGR,SAAS,CAACS,KAAjC;AACA;;AACA,QAAID,cAAc,IAAI,IAAlB,IAA0BA,cAAc,CAACF,WAAf,GAA6BD,QAA7B,CAAsC,aAAtC,CAA9B,EAAoF;AAChFtB,MAAAA,OAAO,CAACwB,eAAR,CAAwBL,aAAxB;AACH;AACJ;AACD;AACJ;AACA;;;AACI,QAAMhB,aAAa,GAAGC,kBAAkB,CAACJ,OAAD,CAAxC;AACA;;AACA,OAAK,IAAIe,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGZ,aAAa,CAACJ,MAAlC,EAA0CgB,CAAC,EAA3C,EAA+C;AAC3CT,IAAAA,eAAe,CAACH,aAAa,CAACY,CAAD,CAAd,CAAf;AACH;AACJ,CA7BD;AA8BA;AACA;AACA;AACA;;;AACA,MAAMX,kBAAkB,GAAIuB,EAAD,IAAQ;AAC/B,SAAQA,EAAE,CAACC,QAAH,IAAe,IAAhB,GAAwBD,EAAE,CAACC,QAA3B,GAAsCD,EAAE,CAACE,UAAhD;AACH,CAFD;;AAGA,MAAMR,iBAAiB,GAAG,CAAC,OAAD,EAAU,IAAV,EAAgB,MAAhB,EAAwB,KAAxB,EAA+B,MAA/B,EAAuC,MAAvC,CAA1B;AACA,MAAM5B,WAAW,GAAG,CAAC,QAAD,EAAW,OAAX,EAAoB,QAApB,EAA8B,MAA9B,EAAsC,MAAtC,EAA8C,QAA9C,EAAwD,OAAxD,CAApB;AAEA,SAAST,iBAAiB,IAAI8C,CAA9B","sourcesContent":["/**\n * Does a simple sanitization of all elements\n * in an untrusted string\n */\nconst sanitizeDOMString = (untrustedString) => {\n    try {\n        if (typeof untrustedString !== 'string' || untrustedString === '') {\n            return untrustedString;\n        }\n        /**\n         * Create a document fragment\n         * separate from the main DOM,\n         * create a div to do our work in\n         */\n        const documentFragment = document.createDocumentFragment();\n        const workingDiv = document.createElement('div');\n        documentFragment.appendChild(workingDiv);\n        workingDiv.innerHTML = untrustedString;\n        /**\n         * Remove any elements\n         * that are blocked\n         */\n        blockedTags.forEach(blockedTag => {\n            const getElementsToRemove = documentFragment.querySelectorAll(blockedTag);\n            for (let elementIndex = getElementsToRemove.length - 1; elementIndex >= 0; elementIndex--) {\n                const element = getElementsToRemove[elementIndex];\n                if (element.parentNode) {\n                    element.parentNode.removeChild(element);\n                }\n                else {\n                    documentFragment.removeChild(element);\n                }\n                /**\n                 * We still need to sanitize\n                 * the children of this element\n                 * as they are left behind\n                 */\n                const childElements = getElementChildren(element);\n                /* tslint:disable-next-line */\n                for (let childIndex = 0; childIndex < childElements.length; childIndex++) {\n                    sanitizeElement(childElements[childIndex]);\n                }\n            }\n        });\n        /**\n         * Go through remaining elements and remove\n         * non-allowed attribs\n         */\n        // IE does not support .children on document fragments, only .childNodes\n        const dfChildren = getElementChildren(documentFragment);\n        /* tslint:disable-next-line */\n        for (let childIndex = 0; childIndex < dfChildren.length; childIndex++) {\n            sanitizeElement(dfChildren[childIndex]);\n        }\n        // Append document fragment to div\n        const fragmentDiv = document.createElement('div');\n        fragmentDiv.appendChild(documentFragment);\n        // First child is always the div we did our work in\n        const getInnerDiv = fragmentDiv.querySelector('div');\n        return (getInnerDiv !== null) ? getInnerDiv.innerHTML : fragmentDiv.innerHTML;\n    }\n    catch (err) {\n        console.error(err);\n        return '';\n    }\n};\n/**\n * Clean up current element based on allowed attributes\n * and then recursively dig down into any child elements to\n * clean those up as well\n */\nconst sanitizeElement = (element) => {\n    // IE uses childNodes, so ignore nodes that are not elements\n    if (element.nodeType && element.nodeType !== 1) {\n        return;\n    }\n    for (let i = element.attributes.length - 1; i >= 0; i--) {\n        const attribute = element.attributes.item(i);\n        const attributeName = attribute.name;\n        // remove non-allowed attribs\n        if (!allowedAttributes.includes(attributeName.toLowerCase())) {\n            element.removeAttribute(attributeName);\n            continue;\n        }\n        // clean up any allowed attribs\n        // that attempt to do any JS funny-business\n        const attributeValue = attribute.value;\n        /* tslint:disable-next-line */\n        if (attributeValue != null && attributeValue.toLowerCase().includes('javascript:')) {\n            element.removeAttribute(attributeName);\n        }\n    }\n    /**\n     * Sanitize any nested children\n     */\n    const childElements = getElementChildren(element);\n    /* tslint:disable-next-line */\n    for (let i = 0; i < childElements.length; i++) {\n        sanitizeElement(childElements[i]);\n    }\n};\n/**\n * IE doesn't always support .children\n * so we revert to .childNodes instead\n */\nconst getElementChildren = (el) => {\n    return (el.children != null) ? el.children : el.childNodes;\n};\nconst allowedAttributes = ['class', 'id', 'href', 'src', 'name', 'slot'];\nconst blockedTags = ['script', 'style', 'iframe', 'meta', 'link', 'object', 'embed'];\n\nexport { sanitizeDOMString as s };\n"]},"metadata":{},"sourceType":"module"}